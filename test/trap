# -*- mode: shell-script -*-


src_file=../src/lib/libcommon.sh

prefix_cmd="
. /etc/shlib

source '$src_file'
"


##
## trap_add
##

try "trap_add EXIT echo 'exited'; echo 'hop'; exit 0"
noerror
is out "hop
exited
"


try "trap_add INT echo 'exited'; echo 'hop'; exit 0"
noerror
is out "hop
"

try "trap_add EXIT,INT echo 'exit/int'
trap_add EXIT echo 'exit'
echo 'hop'" 'last in first out'
noerror
is out "hop
exit
exit/int
"

try "trap_add EXIT,,,,INT echo 'exit/int'
echo hop" 'support empty sigs'
noerror
is out "\
hop
exit/int
"

## Due to a rename of INT -> SIGINT by trap, this was not working
try "trap_add EXIT,INT echo 'exit/int'
trap_add EXIT,INT echo 'exit'" 'double traps on sigs'
noerror
is out "\
exit
exit/int
"


## Apostrophe support
try "trap_add EXIT,INT \"echo 'exit/int\\\$PWD'\"
trap_add EXIT,INT \"echo 'exit1'\"
echo hop
" 'single quote'
noerror
is out "hop
exit1
exit/int\$PWD
"


